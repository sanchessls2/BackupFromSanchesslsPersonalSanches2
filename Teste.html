<html>
<head>

 <style type="text/css">
    .title {
        color: blue;
        text-decoration: bold;
        text-size: 1em;
    }

    .author {
        color: gray;
    }
	.styled-table thead tr {
    background-color: #009879;
    color: #ffffff;
    text-align: left;
}
.styled-table th,
.styled-table td {
    padding: 12px 15px;
}
.styled-table tbody tr {
    border-bottom: 1px solid #dddddd;
}

.styled-table tbody tr:nth-of-type(even) {
    border-bottom: 20px solid #009879;
    background-color: #f3f3f3;
}

.styled-table tbody tr:last-child {
    background-color: lightblue;
}

.styled-table tbody tr:last-of-type {
    border-bottom: 2px solid #009879;
}
.styled-table tbody tr.active-row {
    font-weight: bold;
    color: #009879;
}


    </style>
	</head>
<body>
<table id="mytable" class="styled-table"> 
</table>
<script>

// Create our number formatter.
var formatterP = new Intl.NumberFormat('en-US', {
  style: 'percent',
  
  // These options are needed to round to whole numbers if that's what you want.
  minimumFractionDigits: 3, // (this suffices for whole numbers, but will print 2500.10 as $2,500.1)
  maximumFractionDigits: 3 // (causes 2500.99 to be printed as $2,501)
});

var formatter = new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: 'EUR'

  // These options are needed to round to whole numbers if that's what you want.
  //minimumFractionDigits: 0, // (this suffices for whole numbers, but will print 2500.10 as $2,500.1)
  //maximumFractionDigits: 0, // (causes 2500.99 to be printed as $2,501)
});

  async function getBitCoinValue() {
let response = await fetch("https://blockchain.info/ticker");
let data = await response.json();
return data;


}

   function getFinances() {
     var myList = new Array();
	 myList.push(JSON.parse('{"BitCoinsComprado":0.00036898,"ValorComprado":15.0,"PercentualRevolut":2.5,"ValuesToReturn":null,"BitCoinsFee":9.59E-06}'));
	 myList.push(JSON.parse('{"BitCoinsComprado":0.00287298,"ValorComprado":116.61,"PercentualRevolut":2.5,"ValuesToReturn":null,"BitCoinsFee":7.375E-05}'));
	 return myList;
	 
}

function roundToTwo(num) {    
    return +(Math.round(num + "e+2")  + "e-2");
}


   function CalculaTudo(finances,bitcoin)
   {
   
       var myList2 = new Array();
	  
	    finances.forEach(e => {
		
		  var valorvendaTU = (e.BitCoinsComprado * bitcoin);
		  var valortaxa = ((valorvendaTU * e.PercentualRevolut) / 100);
		  var valorfinalTU = valorvendaTU - valortaxa;
		    
		  var valorPreciso1 = e.ValorComprado/e.BitCoinsComprado;
		  var taxafinal = roundToTwo((e.ValorComprado * e.PercentualRevolut / 100),2); //aqui q vai ter q colocar
		  
		  
		  
		  var valorTaxaAdd = taxafinal / e.BitCoinsComprado;
		  
		    
		  
		  var valorFinalEquivalar = valorPreciso1 + valorTaxaAdd;
		  
  
  
		  
		  var objetoNovo = {  
            ValorComprado: e.ValorComprado,
            BitcoinsTotal: e.BitCoinsComprado,			
			PercentualTaxaVenda: e.PercentualRevolut/100,
			ValorAtualBitCoin: bitcoin,
			ValorQuandoComprado: (e.ValorComprado / (e.BitCoinsComprado + e.BitCoinsFee)),
			ValorQuandoCompradoTax: (e.ValorComprado / (e.BitCoinsComprado )),
			ValorVenda: valorvendaTU,
			ValorTaxavenda: valortaxa,
			ValorFinal: valorfinalTU,
			Diferenca: valorfinalTU - e.ValorComprado,
			DiferencaPercentual: (((valorfinalTU / e.ValorComprado) - 1)),
			ValorEquivalar: valorFinalEquivalar
};
		  
		  
		   
			 
			 
		     myList2.push(objetoNovo);
		})
	   
	   
	   return myList2;
	  
	  
   };
   
   
  function preencheTabela(finances,bitcoin) {
        
		
		var objetoCompleto = CalculaTudo(finances,bitcoin);		
				
		
		
	    var retorno = ``;
		
		retorno += `<thead>
        <tr>
            <th>Valor Comprado</th>
            <th>Bit coins Total</th>
			<th>Percentual Taxa Venda</th>
			<th>Valor Atual Bit Coin</th>
			<th>Valor Quando Comprado</th>
			<th>Valor Comprado + Tax</th>
			<th>Valor Venda</th>
			<th>Valor Taxa venda</th>
			<th>Valor Final</th>
			<th>Diferenca</th>
			<th>Diferenca Percentual</th>
			<th>Valor Equivalar</th>
        </tr>
        </thead>
		    <tbody>`;
			
			var TOTValorComprado = 0.00;
			var TOTBitcoinsTotal = 0;
			var TOTPercentualTaxaVenda = 0;
			var TOTValorAtualBitCoin = 0;
			var TOTValorQuandoComprado = 0;
			var TOTValorQuandoCompradoTax = 0;
			var TOTValorVenda = 0;
			var TOTValorTaxavenda = 0;
			var TOTValorFinal = 0;
			var TOTDiferenca = 0;
			var TOTDiferencaPercentual = 0;
			
			
			objetoCompleto.forEach(element => {
			
			
			
					retorno += `     
					<tr class="active-row">
            <th>${formatter.format(element.ValorComprado)}</th>       
 			
			<th>${element.BitcoinsTotal}</th>
			
			<th>${formatterP.format(element.PercentualTaxaVenda)}</th>
			
			<th>${formatter.format(element.ValorAtualBitCoin)}</th>
			
			<th>${formatter.format(element.ValorQuandoComprado)}</th>
			
			<th>${formatter.format(element.ValorQuandoCompradoTax)}</th>
			
			<th>${formatter.format(element.ValorVenda)}</th>
			
			<th>${formatter.format(element.ValorTaxavenda)}</th>
			
			<th>${formatter.format(element.ValorFinal)}</th>
			
			<th>${formatter.format(element.Diferenca)}</th>
			
			<th>${formatterP.format(element.DiferencaPercentual)}</th>                    
			
			<th>${formatter.format(element.ValorEquivalar)}</th>                    
			
                    </tr>`;
					TOTValorComprado += element.ValorComprado;
                    TOTBitcoinsTotal += element.BitcoinsTotal;
                    TOTPercentualTaxaVenda += element.PercentualTaxaVenda;
                    TOTValorAtualBitCoin += element.ValorAtualBitCoin;
                    TOTValorQuandoComprado += element.ValorQuandoComprado;
                    TOTValorQuandoCompradoTax += element.ValorQuandoCompradoTax;
                    TOTValorVenda += element.ValorVenda;
                    TOTValorTaxavenda += element.ValorTaxavenda;
                    TOTValorFinal += element.ValorFinal;
                    TOTDiferenca += element.Diferenca;                    		
			
			});
			
			
			TOTDiferencaPercentual += TOTValorFinal/TOTValorComprado - 1;
			
			retorno += `<tr> </tr>`;	 		

			
				retorno += `     
					<tr class="active-row">
            <th>${formatter.format(TOTValorComprado)}</th>            
			<th>${TOTBitcoinsTotal}</th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th>${formatter.format(TOTValorVenda)}</th>
			<th>${formatter.format(TOTValorTaxavenda)}</th>
			<th>${formatter.format(TOTValorFinal)}</th>
			<th>${formatter.format(TOTDiferenca)}</th>
			<th>${formatterP.format(TOTDiferencaPercentual)}</th>                    
			<th></th>                    
            </tr>`;



			
			
		
			
		retorno += `</tbody>`;
		
		
      
	           const mytable = document.querySelector("#mytable");
                mytable.innerHTML = retorno;
   
             
  }
  
  
  
  getBitCoinValue().then(data => {  preencheTabela(getFinances(),data.EUR.sell) });




  
</script>
</body>
</html>